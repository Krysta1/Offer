#### TCP三次握手  四次回收
摘自CS-notes
https://blog.csdn.net/qzcsu/article/details/72861891

1. 三次握手 （假设A是客户端，B是服务器端）
- 初始状态为服务器B处于LISTEN状态，等待客户的连接请求。
- A向B发送连接请求报文，SYN=1 ACK=0 seq=x 选择一个初始的序号x
- B收到连接请求报文，如果同意建立连接，向A发送连接确认报文，SYN=1 ACK=1 确认号ack=x+1 初始序号seq=y
- A收到B的连接确认报文后，再向B翻出确认，确认号ack=y+1 序号seq=x+1
- B收到A的确认后，连接建立

三次握手的原因：为了防止失效的连接请求到达服务器，让服务器错误打开连接。如果有链接请求滞留在网络中，等待一个超时重传时间后，会重新请求连接。
但是滞留的连接请求还是会达到服务器。不进行三次握手，服务器就会打开两个连接。

2. 四次挥手 （ACK在连接建立之后都为1）
- A发送连接释放报文，FIN=1
- B收到之后发出确认，此时TCP属于半关闭状态，B能向A发送数据，但是A不能向B发送
- B所有数据发送完毕，不再需要连接，发送连接释放报文，FIN=1
- A收到后发出确认，进入TIME-WAIT状态，等待2MSL（最大报文存活时间）后释放连接。
- B收到A的确认后释放连接

四次挥手的原因：客户端发送了FIN连接释放报文之后，服务器收到了这个报文，就进入了CLOSE-WAIT状态。是为了让服务器发送还未传送完毕的数据，传送完毕后，服务器会发送FIN连接释放报文。

TIME-WAIT：客户端收到服务器端的FIN报文后进入此状态，此时客户端需要等待2MSL时间再进入CLOSED状态。

- 确保最后一个确认报文能够到达。可靠地实现TCP全双工连接的终止。
- 让连接持续时间内所产生的所有报文都从网络中消失，使得下一个新的连接不会出现旧的连接请求报文。

如果建立连接，但是客户端突然出现故障了怎么办？

TCP还设有一个保活计时器，服务器每收到一次客户端的请求后都会重新复位这个计时器，时间通常是设置为2小时，
若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75秒发送一次。若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。

#### TCP和UDP的各自特点对比（传输层）
- UDP主要用在实时性要求高以及对质量相对较弱的地方，如流媒体。
- TCP既然是面向连接的，那么运行环境必然要求其保证可靠性，具有不可丢包、有良好的拥塞控制机制，如http ftp telnet。
- TCP容易阻塞，UDP容易丢包。
- TCP是保证质量不保证速度，UDP保证速度但不保证质量。
- TCP耗系统资源多，UDP耗系统资源少。
- TCP耗系统资源多，UDP耗系统资源少。
- 对于需要保证可靠性的应用，在UDP的基础上再实现轻量级错误重传机制是一种折中的做法，这样既像UDP那样方便使用又能像TCP那样满足可靠性要求。

#### 传输层功能
数据传送，不关心数据含义，进程间的通信

弥补高层（上3层）要求与网络层（基于下3层）数据传送服务质量间的差异（差错率、差错恢复能力、吞吐率、延时、费用等），对高层屏蔽网络层的服务的差异，提供稳定和一致的界面。

#### 传输层和网络层协议的主要区别
网络层（IP层）提供点到点的连接即提供主机之间的逻辑通信，传输层提供端到端的连接——提供进程之间的逻辑通信

#### 面向字节流，面向报文。
面向字节流：虽然应用程序和TCP的交互是一次一个数据块（大小不等），但TCP把应用程序看成是一连串的无结构的字节流。TCP有一个缓冲，当应用程序传送的数据块太长，TCP就可以把它划分短一些再传送。如果应用程序一次只发送一个字节，TCP也可以等待积累有足够多的字节后再构成报文段发送出去。

面向报文：面向报文的传输方式是应用层交给UDP多长的报文，UDP就照样发送，即一次发送一个报文。因此，应用程序必须选择合适大小的报文。若报文太长，则IP层需要分片，降低效率。若太短，会是IP太小。

#### 计算机网络中各层中常见的现协议
应用层：(典型设备:应用程序，如FTP，SMTP ，HTTP) 

- DHCP：动态主机分配协议，使用 UDP 协议工作，主要有两个用途：给内部网络或网络服务供应商自动分配 IP 地址，给用户或者内部网络管理员作为对所有计算机作中央管理的手段。实 现即插即用连网。 
- FTP：文件传输协议<端口号21>减少或消除不同操作系统下处理文件的不兼容性。
- HTTP：超文本传输协议 <端口号 80>， 面向事务的应用层协议
- SMTP：简单邮件传输协议 <端口号25> 用于发送邮件
- RPC：远程过程调用协议

传输层： 典型设备:  进程和端口  数据单元：数据段 （Segment） 

- TCP：传输控制协议提供可靠的面向连接的服务，传输数据前须先建立连接，结束后释放。可靠的全双工信道。可靠、有序、无丢失、不重复。 
- UDP：用户数据报协议发送数据前无需建立连接，不使用拥塞控制，不保证可靠交付，最大努力交付。 

网络层：(典型设备:路由器，防火墙、多层交换机) 数据单元：数据包（Packet ） 

- IP：网络之间互连的协议 
- ARP：即地址解析协议，实现通过IP 地址得 知其物理地址
- RARP：反向地址转换协议允许局域 网的物理机器从网关服务器的 ARP 表或者缓存上请求其 IP地址。 
- ICMP：Internet 控制报文协议。它是TCP/IP 协议族的一个子协议，用于在IP 主机、路由器之间传递控制消息。
- IGMP：Internet 组管理协议,是因特 网协议家族中的一个组播协议，用于 IP  主机向任一个直接相邻的路由器报 告他们的组成员情况。 

数据链路层：(典型设备:  网卡，网桥，交换机)  数据单元：帧 （Frame）

- PPP：点对点协议面向字节，由三部分组成：一个将IP 数据报封装到串行链路的方法；停止等待协议；一个用于建立、配置和测试数据链路连接的链路控制协议
- CSMA/CD：载波监听多点接入/碰撞检测协议。总线型网络，协议的实质是载波监听和碰撞检测。载波监听即发数据前先检测总线上是否有其他计算机在发送数据，如暂时不发数据，避免碰撞。碰撞检测为计算机边发送数据边检测信道上的信号电压大小。
- ARQ：自动重传请求协议，错误纠正协议之一，包括停止等待ARQ 协议和连续ARQ 协议，错误侦测、正面确认、逾时重传与负面确认继以重传等机制。 

物理层：(典型设备：中继器，集线器、网线、HUB)     数据单元：比特 （Bit）

- 以太网物理层、调制解调器、PLC 、SONET/SDH 、G.709 、光导纤维、 同轴电缆、双绞线 

